# 제품 요구사항 문서 (PRD): 산업용 부동산 RAG 챗봇

## 1. 개요
### 1.1 목적
**산업용 부동산 RAG 챗봇**은 **지식산업센터**와 관련된 문의를 가진 사용자(입주 희망 기업, 투자자, 공인중개사)를 돕기 위해 설계된 AI 기반 대화형 에이전트입니다. 이 챗봇은 **검색 증강 생성(RAG)** 기술을 활용하여 특정 법률 문서, 세무 가이드, 입주 자격 기준에 근거한 정확하고 신뢰할 수 있는 답변을 제공합니다.

### 1.2 범위
이 시스템은 다음을 포함합니다:
- Next.js 애플리케이션에 내장된 웹 기반 채팅 인터페이스.
- PDF 문서를 지식 베이스로 변환하는 데이터 처리 파이프라인.
- 로컬 마크다운 파일에서 관련 문맥을 검색하는 RAG 엔진.
- 자연어 생성을 위한 Google Gemini API 연동.
- 품질 관리를 위한 기본적인 대화 로그 저장 기능.

### 1.3 타겟 사용자
- **최종 사용자**: 사무실을 찾는 기업 소유주, 세제 혜택 정보가 필요한 투자자.
- **관리자**: 새로운 규정이나 정보를 지식 베이스에 업데이트해야 하는 부동산 컨설턴트.

## 2. 제품 목표
1.  **정확성**: 환각(Hallucination)을 최소화하기 위해 제공된 문서(법률, 세법 등)에만 근거하여 답변합니다.
2.  **접근성**: 복잡한 법률 및 부동산 정보를 자연어로 쉽게 이해할 수 있도록 제공합니다.
3.  **효율성**: 자주 묻는 질문(FAQ)을 자동화하여 상담원의 업무 부담을 줄입니다.
4.  **확장성**: 현재의 파일 기반 프로토타입에서 향후 프로덕션용 벡터 데이터베이스로 쉽게 전환할 수 있도록 설계합니다.

## 3. 사용자 스토리
| ID | 행위자 | 스토리 | 인수 기준 |
|----|-------|-------|---------------------|
| US-1 | 사용자 | "입주 자격"에 대해 물어보고 내 사업체가 입주 가능한지 확인하고 싶다. | 챗봇이 "입주 자격" 문서에 명시된 구체적인 기준을 답변한다. |
| US-2 | 사용자 | "세제 혜택"에 대해 알고 싶어 잠재적인 절세액을 계산해보고 싶다. | 챗봇이 취득세 및 재산세 감면 조건과 내용을 나열한다. |
| US-3 | 관리자 | 새로운 PDF(예: "2024년 세법")를 업로드하여 챗봇이 최신 규칙을 알게 하고 싶다. | 시스템이 PDF를 마크다운으로 변환하고 검색 문맥에 포함시킨다. |
| US-4 | 개발자 | 잘못된 답변을 디버깅하기 위해 대화 로그를 보고 싶다. | 대화 내역이 타임스탬프와 함께 `data/chat_logs.json`에 저장된다. |

## 4. 기능 요구사항

### 4.1 채팅 인터페이스
- **플로팅 위젯**: 모든 페이지에서 접근 가능한 채팅 버튼 및 대화창.
- **대화 내역**: 사용자와 봇의 메시지를 스크롤 가능한 뷰로 표시.
- **로딩 상태**: AI가 답변을 생성하는 동안 타이핑 표시기 노출.
- **마크다운 지원**: AI 답변 내의 굵은 글씨, 목록, 링크 등을 렌더링.

### 4.2 RAG 엔진 (프로토타입)
- **문맥 검색**:
  - **현재 방식**: `data/` 디렉토리의 모든 `.md` 파일을 읽음.
  - **로직**: 관련 파일 내용(MVP에서는 전체 내용)을 연결하여 프롬프트 문맥으로 제공.
- **LLM 연동**:
  - 생성을 위해 **Google Gemini** (Vercel AI SDK 경유) 사용.
  - 시스템 프롬프트에 "제공된 문맥에 기반해서만 답변할 것"을 강제.

### 4.3 데이터 파이프라인
- **입력**: `data/raw` 폴더에 위치한 PDF 파일.
- **처리**: `pdf-parse`를 사용하여 텍스트를 추출하는 스크립트 (`scripts/convert-pdf.js`).
- **출력**: `data/` 폴더에 저장되는 마크다운 파일.
- **실행**: 스크립트 수동 실행 (`node scripts/convert-pdf.js`).

### 4.4 로깅 및 분석
- **저장소**: 대화 세션을 `data/chat_logs.json`에 추가.
- **데이터 포인트**: 타임스탬프, 사용자 ID (세션 기반), 질문, 답변, 출처 문서 ID (가능한 경우).

## 5. 비기능 요구사항
- **성능**: 일반적인 질문에 대해 3초 이내 응답.
- **신뢰성**: API 다운 또는 문맥 누락 시 우아한 에러 처리.
- **보안**:
  - API 키(Google Gemini)는 `.env.local`에 저장하고 클라이언트에 노출하지 않음.
  - 동의 없이 민감한 사용자 정보(PII)를 로그에 남기지 않음.
- **유지보수성**: `lib/`, `components/`, `app/` 등으로 명확히 분리된 코드 구조.

## 6. 기술 아키텍처

### 6.1 기술 스택
- **프레임워크**: Next.js 14+ (App Router)
- **언어**: TypeScript
- **스타일링**: Tailwind CSS
- **AI SDK**: Vercel AI SDK (`ai`, `@ai-sdk/google`)
- **모델**: Google Gemini Pro
- **PDF 처리**: `pdf-parse`

### 6.2 데이터 흐름
1.  **수집**: `PDF` -> `convert-pdf.js` -> `Markdown` -> `data/` 폴더.
2.  **질의**: 사용자 입력 -> `ChatWidget` -> `POST /api/chat`.
3.  **검색**: `api/chat` -> `lib/rag.ts` -> `data/*.md` 읽기 -> 문맥 문자열 생성.
4.  **생성**: 문맥 + 질문 -> Google Gemini API -> 스트리밍 응답.
5.  **응답**: 스트림 -> `ChatWidget` (화면 표시).

## 7. 향후 로드맵 (Post-MVP)
- **2단계**: 모든 파일을 로딩하는 대신 시맨틱 검색을 위한 벡터 데이터베이스(Pinecone 또는 pgvector) 도입.
- **3단계**: UI를 통해 직접 PDF를 업로드할 수 있는 관리자 대시보드.
- **4단계**: 멀티턴 대화 메모리 (질문 간의 문맥 유지).
- **5단계**: 인용구 강조 (문서의 어느 단락이 사용되었는지 표시).

## 8. 열린 질문 / 위험 요소
- **컨텍스트 윈도우 제한**: 데이터가 늘어나면 모든 마크다운 파일을 로딩하는 것이 Gemini의 컨텍스트 윈도우를 초과할 수 있음. *완화책: 2단계에서 벡터 DB로 전환.*
- **PDF 파싱 품질**: PDF 내의 복잡한 레이아웃(표, 다단)이 텍스트로 깔끔하게 변환되지 않을 수 있음. *완화책: 마크다운 파일 수동 검수 또는 OCR 도입.*
